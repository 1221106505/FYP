<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Order History - Virtual BookStore</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --info: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            font-weight: 500;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-back {
            background: var(--success);
            color: white;
        }

        /* Order Status Styles */
        .order-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-confirmed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-shipped {
            background: #cce7ff;
            color: #004085;
        }

        .status-delivered {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        /* Payment Status Styles */
        .payment-status {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .payment-pending {
            background: #fff3cd;
            color: #856404;
        }

        .payment-completed {
            background: #d4edda;
            color: #155724;
        }

        .payment-failed {
            background: #f8d7da;
            color: #721c24;
        }

        .payment-refunded {
            background: #e2e3e5;
            color: #383d41;
        }

        /* Payment Method Badge */
        .payment-method-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            background: #e9ecef;
            color: #495057;
            display: inline-block;
            margin-top: 4px;
        }

        /* Orders List */
        .orders-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 25px;
        }

        .order-card {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .order-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .order-id {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .order-date {
            color: #666;
            font-size: 0.9rem;
        }

        .order-details {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .order-items {
            margin-bottom: 15px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .item-author {
            color: #666;
            font-size: 0.9rem;
        }

        .item-quantity, .item-price {
            font-weight: 500;
            margin: 0 10px;
        }

        .order-total {
            text-align: right;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            border-top: 2px solid #e9ecef;
            padding-top: 10px;
        }

        /* Payment History Section */
        .payment-history {
            margin-top: 20px;
            border-top: 1px solid #e9ecef;
            padding-top: 15px;
        }

        .payment-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--info);
        }

        .payment-item.completed {
            border-left-color: var(--success);
        }

        .payment-item.failed {
            border-left-color: var(--danger);
        }

        .payment-item.refunded {
            border-left-color: #6c757d;
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .payment-method {
            font-weight: 600;
            color: var(--primary);
        }

        .payment-date {
            color: #666;
            font-size: 0.85rem;
        }

        .payment-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-amount {
            font-weight: 600;
            color: var(--success);
        }

        .transaction-id {
            font-size: 0.8rem;
            color: #666;
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* Filter Controls */
        .filter-controls {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .filter-select {
            padding: 8px 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
            color: #495057;
            font-size: 14px;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .stats-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .no-orders {
            text-align: center;
            padding: 60px 40px;
            color: #6c757d;
            background: white;
            border-radius: 12px;
        }

        .no-orders h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: var(--danger);
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 12px;
        }

        /* Login Prompt */
        .login-prompt {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .login-prompt h2 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        .login-prompt p {
            color: #666;
            margin-bottom: 25px;
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .order-details {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .order-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-card {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .order-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .item-quantity, .item-price {
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üì¶ My Order History</h1>
            <div class="user-info">
                <span id="welcomeUser">Welcome, Guest</span>
                <a href="user_profile.html" class="btn btn-back">üë§ Profile</a>
                <a href="Main.html" class="btn btn-secondary">üè† Main</a>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div id="orderStats" class="stats-card hidden">
            <div class="stat-item">
                <div class="stat-value" id="totalOrders">0</div>
                <div class="stat-label">Total Orders</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalSpent">RM 0.00</div>
                <div class="stat-label">Total Spent</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="completedPayments">0</div>
                <div class="stat-label">Paid Orders</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="pendingPayments">0</div>
                <div class="stat-label">Pending Payments</div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div id="filterControls" class="filter-controls hidden">
            <div style="font-weight: 600; color: var(--primary);">Filter Orders:</div>
            <select id="statusFilter" class="filter-select" onchange="filterOrders()">
                <option value="all">All Statuses</option>
                <option value="pending">Pending</option>
                <option value="confirmed">Confirmed</option>
                <option value="shipped">Shipped</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
            </select>
            <select id="dateFilter" class="filter-select" onchange="filterOrders()">
                <option value="all">All Time</option>
                <option value="30">Last 30 Days</option>
                <option value="90">Last 90 Days</option>
                <option value="365">Last Year</option>
            </select>
            <button class="btn btn-primary" onclick="refreshOrders()">
                üîÑ Refresh
            </button>
        </div>

        <!-- Main Content -->
        <div id="orderContent">
            <div class="login-prompt" id="loginPrompt">
                <h2>Please Login</h2>
                <p>You need to be logged in to view your order history.</p>
                <a href="../Login/Login.html" class="btn btn-primary">Go to Login</a>
            </div>
            
            <div id="ordersList" class="hidden">
                <div class="orders-container">
                    <div id="ordersContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>Loading your orders...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API endpoints
        const API_ENDPOINTS = {
            orders: 'get_customer_orders.php',
            checkLogin: 'check_login.php'
        };

        // Global variables
        let allOrders = [];
        let currentCustomerId = null;
        let filteredOrders = [];

        // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅÂπ∂Âä†ËΩΩËÆ¢Âçï
        async function loadOrderHistory() {
            console.log('Starting order history load...');
            
            try {
                const response = await fetch(API_ENDPOINTS.checkLogin, {
                    credentials: 'include',
                    headers: { 'Cache-Control': 'no-cache' }
                });
                
                console.log('Login check response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Login check result:', data);
                
                const loginPrompt = document.getElementById('loginPrompt');
                const ordersList = document.getElementById('ordersList');
                const filterControls = document.getElementById('filterControls');
                const orderStats = document.getElementById('orderStats');
                
                if (data.logged_in && (data.user_id || data.auto_id)) {
                    console.log('User is logged in');
                    
                    // ÊòæÁ§∫Áî®Êà∑Ê¨¢Ëøé‰ø°ÊÅØ
                    const username = data.username || data.first_name || 'User';
                    document.getElementById('welcomeUser').textContent = `Welcome, ${username}`;
                    
                    currentCustomerId = data.user_id || data.auto_id;
                    
                    // ÊòæÁ§∫ËÆ¢ÂçïÂÜÖÂÆπ
                    loginPrompt.classList.add('hidden');
                    ordersList.classList.remove('hidden');
                    filterControls.classList.remove('hidden');
                    orderStats.classList.remove('hidden');
                    
                    // Âä†ËΩΩÁî®Êà∑ËÆ¢Âçï
                    await loadCustomerOrders();
                } else {
                    console.log('User is not logged in');
                    // Áî®Êà∑Êú™ÁôªÂΩïÔºåÊòæÁ§∫ÁôªÂΩïÊèêÁ§∫
                    loginPrompt.classList.remove('hidden');
                    ordersList.classList.add('hidden');
                    filterControls.classList.add('hidden');
                    orderStats.classList.add('hidden');
                }
            } catch (error) {
                console.error('Error loading order history:', error);
                showError('Error loading orders. Please try again later.');
            }
        }

        // Âä†ËΩΩÈ°æÂÆ¢ËÆ¢Âçï
        async function loadCustomerOrders() {
            if (!currentCustomerId) {
                showError('Customer ID not found');
                return;
            }
            
            console.log('Loading orders for customer:', currentCustomerId);
            
            try {
                const response = await fetch(`${API_ENDPOINTS.orders}?customer_id=${currentCustomerId}`, {
                    credentials: 'include',
                    headers: { 'Cache-Control': 'no-cache' }
                });
                
                console.log('Orders response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch orders: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Orders data received:', data);
                
                if (data.success && data.orders && data.orders.length > 0) {
                    console.log(`Found ${data.orders.length} orders`);
                    allOrders = data.orders;
                    
                    // ÊòæÁ§∫ËÆ¢Âçï
                    filterOrders();
                    
                    // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
                    if (data.payment_stats) {
                        updatePaymentStats(data);
                    } else {
                        updateStats();
                    }
                } else {
                    console.log('No orders found or API returned error');
                    showNoOrders();
                }
            } catch (error) {
                console.error('Error loading customer orders:', error);
                showError('Error loading orders. Please try again later.');
            }
        }

        // ËøáÊª§ËÆ¢Âçï
        function filterOrders() {
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            filteredOrders = allOrders.filter(order => {
                // Áä∂ÊÄÅËøáÊª§
                if (statusFilter !== 'all' && order.status !== statusFilter) {
                    return false;
                }
                
                // Êó•ÊúüËøáÊª§
                if (dateFilter !== 'all') {
                    const days = parseInt(dateFilter);
                    const orderDate = new Date(order.order_date);
                    const cutoffDate = new Date();
                    cutoffDate.setDate(cutoffDate.getDate() - days);
                    
                    if (orderDate < cutoffDate) {
                        return false;
                    }
                }
                
                return true;
            });
            
            displayOrders(filteredOrders);
        }

        // ÊòæÁ§∫ËÆ¢Âçï
        function displayOrders(orders) {
            const ordersContainer = document.getElementById('ordersContainer');
            
            if (orders.length === 0) {
                ordersContainer.innerHTML = `
                    <div class="no-orders">
                        <h3>No Orders Found</h3>
                        <p>No orders match your current filters.</p>
                        <button class="btn btn-primary" onclick="resetFilters()" style="margin-top: 15px;">
                            Reset Filters
                        </button>
                    </div>
                `;
                return;
            }
            
            ordersContainer.innerHTML = orders.map(order => {
                const orderDate = new Date(order.order_date);
                const orderItems = order.items || [];
                
                return `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <div class="order-id">Order #${order.order_id}</div>
                            <div class="order-date">${orderDate.toLocaleDateString()} at ${orderDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                        </div>
                        <div class="order-status ${getStatusClass(order.status)}">
                            ${getStatusText(order.status)}
                        </div>
                    </div>
                    
                    <div class="order-details">
                        <div>
                            <strong>Shipping Address:</strong><br>
                            <small>${escapeHtml(order.shipping_address || 'No address provided')}</small>
                        </div>
                        <div>
                            <strong>Contact:</strong><br>
                            <small>${escapeHtml(order.contact_phone || 'N/A')}</small>
                        </div>
                        <div>
                            <strong>Payment:</strong><br>
                            <small>
                                ${escapeHtml(order.payment_method_display || getPaymentMethodText(order.payment_method) || 'Not Specified')}<br>
                                <span class="payment-method-badge">${escapeHtml(order.payment_method || 'N/A')}</span>
                            </small>
                        </div>
                        <div>
                            <strong>Payment Status:</strong><br>
                            <span class="payment-status ${getPaymentStatusClass(order.payment_status)}">
                                ${escapeHtml(order.payment_status_display || order.payment_status || 'Pending')}
                            </span><br>
                            <strong style="display: block; margin-top: 4px;">Total:</strong>
                            <strong>RM ${parseFloat(order.total_amount || 0).toFixed(2)}</strong>
                        </div>
                    </div>
                    
                    ${orderItems.length > 0 ? `
                        <div class="order-items">
                            <strong>Order Items (${orderItems.length}):</strong>
                            ${orderItems.map(item => {
                                const bookTitle = item.book_title || item.title || 'Unknown Book';
                                const author = item.author || 'Unknown Author';
                                const quantity = item.quantity || 0;
                                const unitPrice = parseFloat(item.unit_price || item.price || 0).toFixed(2);
                                const subtotal = parseFloat(item.subtotal || (quantity * parseFloat(unitPrice))).toFixed(2);
                                
                                return `
                                <div class="order-item">
                                    <div class="item-info">
                                        <div class="item-title">${escapeHtml(bookTitle)}</div>
                                        <div class="item-author">by ${escapeHtml(author)}</div>
                                    </div>
                                    <div class="item-quantity">Qty: ${quantity}</div>
                                    <div class="item-price">RM ${unitPrice}</div>
                                    <div class="item-subtotal">RM ${subtotal}</div>
                                </div>
                                `;
                            }).join('')}
                        </div>
                    ` : '<div class="order-items"><em>No items found for this order</em></div>'}
                    
                    <!-- Payment Details Section -->
                    <div class="payment-history">
                        <strong>Payment Details:</strong>
                        <div class="payment-item ${order.payment_status || 'pending'}">
                            <div class="payment-header">
                                <div class="payment-method">
                                    ${escapeHtml(order.payment_method_display || getPaymentMethodText(order.payment_method) || 'Payment Method')}
                                </div>
                                <div class="payment-status ${getPaymentStatusClass(order.payment_status)}">
                                    ${escapeHtml(order.payment_status_display || order.payment_status || 'PENDING').toUpperCase()}
                                </div>
                            </div>
                            <div class="payment-details">
                                <div class="payment-amount">
                                    RM ${parseFloat(order.payment_amount || order.total_amount || 0).toFixed(2)}
                                </div>
                                <div class="payment-date">
                                    ${order.payment_date ? new Date(order.payment_date).toLocaleDateString() : 'Not Paid Yet'}
                                </div>
                            </div>
                            ${order.transaction_id ? `
                            <div style="margin-top: 8px; font-size: 0.8rem;">
                                <strong>Transaction ID:</strong>
                                <div class="transaction-id">${escapeHtml(order.transaction_id)}</div>
                            </div>
                            ` : ''}
                            ${order.notes ? `
                            <div style="margin-top: 8px; font-size: 0.8rem;">
                                <strong>Notes:</strong>
                                <div>${escapeHtml(order.notes)}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        function updateStats() {
            if (allOrders.length === 0) {
                document.getElementById('totalOrders').textContent = '0';
                document.getElementById('totalSpent').textContent = 'RM 0.00';
                document.getElementById('completedPayments').textContent = '0';
                document.getElementById('pendingPayments').textContent = '0';
                return;
            }
            
            // ËÆ°ÁÆóÁªüËÆ°
            const totalSpent = allOrders.reduce((sum, order) => sum + parseFloat(order.total_amount || 0), 0);
            const completedPayments = allOrders.filter(order => order.payment_status === 'completed').length;
            const pendingPayments = allOrders.filter(order => order.payment_status === 'pending').length;
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            document.getElementById('totalOrders').textContent = allOrders.length;
            document.getElementById('totalSpent').textContent = `RM ${totalSpent.toFixed(2)}`;
            document.getElementById('completedPayments').textContent = completedPayments;
            document.getElementById('pendingPayments').textContent = pendingPayments;
        }

        // Êõ¥Êñ∞ÊîØ‰ªòÁªüËÆ°‰ø°ÊÅØ
        function updatePaymentStats(data) {
            const stats = data.payment_stats || {};
            
            // ÊÄªËÆ¢ÂçïÊï∞
            document.getElementById('totalOrders').textContent = data.order_count || allOrders.length;
            
            // ÊÄªÊ∂àË¥πÈ¢ù
            const totalSpent = stats.total_spent || 
                allOrders.reduce((sum, order) => sum + parseFloat(order.total_amount || 0), 0);
            document.getElementById('totalSpent').textContent = `RM ${totalSpent.toFixed(2)}`;
            
            // ÂÆåÊàêÊîØ‰ªòÊï∞
            document.getElementById('completedPayments').textContent = 
                stats.completed_payments || 
                allOrders.filter(order => order.payment_status === 'completed').length;
            
            // ÂæÖÊîØ‰ªòÊï∞
            document.getElementById('pendingPayments').textContent = 
                stats.pending_payments || 
                allOrders.filter(order => order.payment_status === 'pending').length;
        }

        // ÊòæÁ§∫Êó†ËÆ¢Âçï
        function showNoOrders() {
            const ordersContainer = document.getElementById('ordersContainer');
            ordersContainer.innerHTML = `
                <div class="no-orders">
                    <h3>No Orders Found</h3>
                    <p>You haven't placed any orders yet.</p>
                    <a href="Searching.html" class="btn btn-primary" style="margin-top: 15px;">
                        üõçÔ∏è Start Shopping
                    </a>
                </div>
            `;
        }

        // ÊòæÁ§∫ÈîôËØØ
        function showError(message) {
            const ordersContainer = document.getElementById('ordersContainer');
            ordersContainer.innerHTML = `
                <div class="error">
                    <h3>Error</h3>
                    <p>${escapeHtml(message)}</p>
                    <button class="btn btn-primary" onclick="loadOrderHistory()" style="margin-top: 15px;">
                        Retry
                    </button>
                </div>
            `;
        }

        // ÈáçÁΩÆËøáÊª§Âô®
        function resetFilters() {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('dateFilter').value = 'all';
            filterOrders();
        }

        // Âà∑Êñ∞ËÆ¢Âçï
        function refreshOrders() {
            const ordersContainer = document.getElementById('ordersContainer');
            const statsCard = document.getElementById('orderStats');
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            ordersContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Refreshing orders...</p>
                </div>
            `;
            
            // ÊòæÁ§∫ÁªüËÆ°Âä†ËΩΩÁä∂ÊÄÅ
            const statItems = statsCard.querySelectorAll('.stat-item');
            statItems.forEach(item => {
                item.classList.add('loading');
                item.querySelector('.stat-value').textContent = '...';
            });
            
            // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
            loadCustomerOrders();
        }

        // ËæÖÂä©ÂáΩÊï∞
        function getStatusClass(status) {
            const statusMap = {
                'pending': 'status-pending',
                'confirmed': 'status-confirmed',
                'shipped': 'status-shipped',
                'delivered': 'status-delivered',
                'cancelled': 'status-cancelled'
            };
            return statusMap[status] || 'status-pending';
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'Pending',
                'confirmed': 'Confirmed',
                'shipped': 'Shipped',
                'delivered': 'Delivered',
                'cancelled': 'Cancelled'
            };
            return statusMap[status] || status;
        }

        function getPaymentStatusClass(status) {
            const statusMap = {
                'pending': 'payment-pending',
                'completed': 'payment-completed',
                'failed': 'payment-failed',
                'refunded': 'payment-refunded'
            };
            return statusMap[status] || 'payment-pending';
        }

        function getPaymentMethodText(method) {
            const methodMap = {
                'credit_card': 'Credit Card',
                'debit_card': 'Debit Card',
                'paypal': 'PayPal',
                'bank_transfer': 'Bank Transfer',
                'cash_on_delivery': 'Cash on Delivery'
            };
            return methodMap[method] || (method ? method.replace('_', ' ').toUpperCase() : 'Not Specified');
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÊâßË°å
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Order History Page Loaded');
            loadOrderHistory();
        });
    </script>
</body>
</html>
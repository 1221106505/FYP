<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Virtual BookStore</title>
  <link rel="stylesheet" href="Main.css">
</head>
<body>
  <section class="mainbackground">
    <h1>Welcome To Virtual BookStore!</h1>
    
    <div class="user-info" id="userInfo">
      <!-- 这里会被JavaScript动态更新 -->
      <a href="../Login/Login.html">
        <button class="login-button" id="loginButton">Login</button>
      </a>
    </div>
  </section>

  <div id="welcomeMessage" class="welcome-message hidden"></div>

  <section class="content">
    <div class="content-header">
      <h2>About Virtual BookStore</h2>
    </div>
    <div class="content-body">
      <p>Welcome to your ultimate online book destination! At Virtual BookStore, we bring the world of literature to your fingertips.</p>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">📚</div>
          <h3>Vast Collection</h3>
          <p>Discover thousands of books across all genres from bestsellers to hidden gems.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">🚚</div>
          <h3>Fast Delivery</h3>
          <p>Get your books delivered quickly with our reliable shipping service.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">💰</div>
          <h3>Best Prices</h3>
          <p>Enjoy competitive prices and regular discounts on your favorite books.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">⭐</div>
          <h3>Customer Reviews</h3>
          <p>Make informed choices with authentic reviews from our reading community.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="services">
    <h2>Our Services</h2>
    <div class="services-container">
      <div class="service-item">
        <a href="AddBook.html" class="service-link">
          <div class="service-icon">➕</div>
          <h3>Add New Book</h3>
          <p>Contribute to our collection by adding new books to the store.</p>
        </a>
      </div>
      <div class="service-item">
        <a href="Searching.html" class="service-link">
          <div class="service-icon">🔍</div>
          <h3>Search Books</h3>
          <p>Find exactly what you're looking for with our powerful search tool.</p>
        </a>
      </div>
      <div class="service-item">
        <a href="user_profile.html" class="service-link">
          <div class="service-icon">👤</div>
          <h3>My Profile</h3>
          <p>Manage your account, view orders, and update preferences.</p>
        </a>
      </div>
      <div class="service-item">
        <a href="About.html" class="service-link">
          <div class="service-icon">ℹ️</div>
          <h3>About Us</h3>
          <p>Learn more about our mission and the team behind Virtual BookStore.</p>
        </a>
      </div>
    </div>
  </section>

  <section class="bestsellers">
    <h2>Current Bestsellers</h2>
    <div class="books-grid">
      <div class="book-card">
        <div class="book-cover">📖</div>
        <h4>The Midnight Library</h4>
        <p>Matt Haig</p>
        <div class="book-price">$14.99</div>
      </div>
      <div class="book-card">
        <div class="book-cover">📖</div>
        <h4>Project Hail Mary</h4>
        <p>Andy Weir</p>
        <div class="book-price">$16.99</div>
      </div>
      <div class="book-card">
        <div class="book-cover">📖</div>
        <h4>The Four Winds</h4>
        <p>Kristin Hannah</p>
        <div class="book-price">$15.99</div>
      </div>
      <div class="book-card">
        <div class="book-cover">📖</div>
        <h4>Klara and the Sun</h4>
        <p>Kazuo Ishiguro</p>
        <div class="book-price">$17.99</div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h4>Virtual BookStore</h4>
        <p>Your online destination for all things books. Read, explore, and discover.</p>
      </div>
      <div class="footer-section">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="Main.html">Home</a></li>
          <li><a href="About.html">About</a></li>
          <li><a href="Searching.html">Search Books</a></li>
          <li><a href="user_profile.html">My Account</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Contact Info</h4>
        <p>📧 support@virtualbookstore.com</p>
        <p>📞 1-800-BOOKS-NOW</p>
        <p>📍 123 Book Street, Readerville</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 Virtual BookStore. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // 检查登录状态并更新UI
    function checkLoginStatus() {
      fetch('check_login.php')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          updateUserInterface(data);
        })
        .catch(error => {
          // 如果check_login.php不存在，使用URL参数回退
          fallbackToURLParams();
        });
    }

    // 更新用户界面
    function updateUserInterface(userData) {
      const userInfo = document.getElementById('userInfo');
      
      if (!userInfo) return;

      if (userData.logged_in) {
        // 获取用户头像数据
        const userProfile = getUserAvatarData(userData.username);
        
        // 用户已登录，显示头像和用户名
        userInfo.innerHTML = `
          <a href="user_profile.html">
            <button class="user-button">
              <div class="main-avatar">
                ${userProfile.avatarType === 'image' && userProfile.avatarImage ? 
                  `<img src="${userProfile.avatarImage}" class="main-avatar-img" alt="Avatar">` : 
                  `<div class="main-avatar-emoji">${userProfile.avatarValue}</div>`
                }
              </div>
              ${userData.username}
            </button>
          </a>
        `;
        
        // 设置头像背景颜色（如果是emoji）
        if (userProfile.avatarType === 'emoji') {
          const avatarElement = userInfo.querySelector('.main-avatar');
          const colors = ['#6a11cb', '#2575fc', '#28a745', '#dc3545', '#fd7e14', '#6f42c1'];
          const color = colors[userProfile.avatarValue.charCodeAt(0) % colors.length];
          avatarElement.style.background = `linear-gradient(135deg, ${color} 0%, ${color}99 100%)`;
        }
      } else {
        // 用户未登录，显示登录按钮
        userInfo.innerHTML = `
          <a href="../Login/Login.html">
            <button class="login-button">Login</button>
          </a>
        `;
      }
    }

    // 获取用户头像数据
    function getUserAvatarData(username) {
      const savedData = localStorage.getItem(`userProfile_${username}`);
      if (savedData) {
        const userData = JSON.parse(savedData);
        return {
          avatarType: userData.avatarType || 'emoji',
          avatarValue: userData.avatarValue || '👤',
          avatarImage: userData.avatarImage || null
        };
      }
      
      // 默认头像数据
      return {
        avatarType: 'emoji',
        avatarValue: '👤',
        avatarImage: null
      };
    }

    // 回退方案：如果check_login.php不存在，使用URL参数
    function fallbackToURLParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const loginSuccess = urlParams.get('login_success');
      const username = urlParams.get('username');
      
      if (loginSuccess === '1' && username) {
        const userInfo = document.getElementById('userInfo');
        if (userInfo) {
          const userProfile = getUserAvatarData(username);
          
          userInfo.innerHTML = `
            <a href="user_profile.html">
              <button class="user-button">
                <div class="main-avatar">
                  ${userProfile.avatarType === 'image' && userProfile.avatarImage ? 
                    `<img src="${userProfile.avatarImage}" class="main-avatar-img" alt="Avatar">` : 
                    `<div class="main-avatar-emoji">${userProfile.avatarValue}</div>`
                  }
                </div>
                ${decodeURIComponent(username)}
              </button>
            </a>
          `;
          
          // 设置头像背景颜色（如果是emoji）
          if (userProfile.avatarType === 'emoji') {
            const avatarElement = userInfo.querySelector('.main-avatar');
            const colors = ['#6a11cb', '#2575fc', '#28a745', '#dc3545', '#fd7e14', '#6f42c1'];
            const color = colors[userProfile.avatarValue.charCodeAt(0) % colors.length];
            avatarElement.style.background = `linear-gradient(135deg, ${color} 0%, ${color}99 100%)`;
          }
        }
      }
    }

    // 检查URL参数显示欢迎消息
    function checkURLParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const loginSuccess = urlParams.get('login_success');
      const username = urlParams.get('username');
      
      if (loginSuccess === '1' && username) {
        const welcomeMsg = document.getElementById('welcomeMessage');
        if (welcomeMsg) {
          welcomeMsg.textContent = `Welcome back, ${decodeURIComponent(username)}! Login successful.`;
          welcomeMsg.classList.remove('hidden');
          
          setTimeout(() => {
            welcomeMsg.classList.add('hidden');
          }, 5000);
        }
        
        // 清除URL参数但不刷新页面
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
      }
    }

    // 页面加载时执行
    document.addEventListener('DOMContentLoaded', function() {
      checkLoginStatus();
      checkURLParams();
      
      // 添加一些交互效果
      addInteractivity();
    });

    // 添加交互效果
    function addInteractivity() {
      // 为服务卡片添加悬停效果
      const serviceItems = document.querySelectorAll('.service-item');
      serviceItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-5px)';
        });
        item.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      });

      // 为书籍卡片添加悬停效果
      const bookCards = document.querySelectorAll('.book-card');
      bookCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'scale(1.05)';
        });
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'scale(1)';
        });
      });
    }
  </script>
</body>
</html>